---
title: "climatechange_report_dyn"
author: "Till Meissner"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Option 1: Using `crosstalk` for linked filtering (recommended)

```{r plot-mean-deviation-select, fig.height=10}
era5_shared <- SharedData$new(
  era5_temp_annual |> filter(name %in% sort(unique(era5_temp_annual$name))),
  key = ~name,
  group = "gov_selection"
)

bscols(
  widths = c(3, 9),
  filter_select("name", "Select Governorate:", era5_shared, ~name, 
                allLevels = FALSE,
                multiple = FALSE),
  plot_ly(era5_shared, x = ~year, y = ~temp_diff_mean_pop, color = ~temp_diff_mean_pop,
          colors = colorRamp(c("#0571b0", "white", "#ca0020")),
          type = "bar") |>
    layout(
      title = "Mean Temperature - Deviation from Baseline (Population-weighted)",
      xaxis = list(title = "Year"),
      yaxis = list(title = "Temperature Deviation (Â°C)"),
      legend = list(orientation = "h", y = -0.2,x = 0.5,xanchor = "center"),
      hovermode = "closest")
)
```

